"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[619],{84764:(e,t,n)=>{n.d(t,{Z:()=>o});const o=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]]},72076:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(84995),a=n(96824),i=n(36377);function r(e,t,n,r,s,d={},l=""){const{color:c,width:g,lineWidth:h,lineDash:u}=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},d),m=h||g,f=(0,o.Z)(t,"rect",n),p=e.getSvgNode(f),v=[Math.min(r[0],s[0]),Math.min(r[1],s[1])],I=Math.abs(r[0]-s[0]),S=Math.abs(r[1]-s[1]),w={x:`${v[0]}`,y:`${v[1]}`,width:`${I}`,height:`${S}`,stroke:c,fill:"transparent","stroke-width":m,"stroke-dasharray":u};if(p)(0,a.Z)(w,p),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");""!==l&&t.setAttribute("data-id",l),(0,i.Z)(w,t),e.appendNode(t,f)}}},1182:(e,t,n)=>{var o;n.d(t,{Z:()=>a}),function(e){e.Labelmap="LABELMAP",e.Contour="CONTOUR"}(o||(o={}));const a=o},60443:(e,t,n)=>{n.r(t),n.d(t,{getActiveSegmentationRepresentation:()=>i,setActiveSegmentationRepresentation:()=>r});var o=n(57756),a=n(35316);function i(e){const t=(0,o.getDefaultSegmentationStateManager)().getSegmentationRepresentations(e);if(!t)return;return t.find((e=>e.active))}function r(e,t){(0,o.getDefaultSegmentationStateManager)().setActiveSegmentationRepresentation(e,t),(0,a.triggerSegmentationRepresentationModified)(e,t)}},87044:(e,t,n)=>{n.r(t),n.d(t,{addColorLUT:()=>r,getColorForSegmentIndex:()=>d,setColorForSegmentIndex:()=>l,setColorLUT:()=>s});var o=n(84944),a=n(57756),i=n(35316);function r(e,t){if(!e)throw new Error("addColorLUT: colorLUT is required");o.Z(e[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),e.unshift([0,0,0,0])),a.addColorLUT(e,t)}function s(e,t,n){const o=a.getSegmentationRepresentationByUID(e,t);if(!o)throw new Error(`setColorLUT: could not find segmentation representation with UID ${t}`);if(!a.getColorLUT(n))throw new Error(`setColorLUT: could not find colorLUT with index ${n}`);o.colorLUTIndex=n,(0,i.triggerSegmentationRepresentationModified)(e,t)}function d(e,t,n){const o=a.getSegmentationRepresentationByUID(e,t);if(!o)throw new Error(`segmentation representation with UID ${t} does not exist for tool group ${e}`);const{colorLUTIndex:i}=o;return a.getColorLUT(i)[n]}function l(e,t,n,o){const a=d(e,t,n);for(let e=0;e<o.length;e++)a[e]=o[e];(0,i.triggerSegmentationRepresentationModified)(e,t)}},27977:(e,t,n)=>{n.r(t),n.d(t,{getActiveSegmentIndex:()=>r,setActiveSegmentIndex:()=>i});var o=n(57756),a=n(35316);function i(e,t){const n=(0,o.getSegmentation)(e);n?.activeSegmentIndex!==t&&(n.activeSegmentIndex=t,(0,a.triggerSegmentationModified)(e))}function r(e){const t=(0,o.getSegmentation)(e);if(t)return t.activeSegmentIndex}},33861:(e,t,n)=>{n.r(t),n.d(t,{getLockedSegments:()=>s,isSegmentIndexLocked:()=>i,setSegmentIndexLocked:()=>r});var o=n(57756),a=n(35316);function i(e,t){const n=(0,o.getSegmentation)(e);if(!n)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:a}=n;return a.has(t)}function r(e,t,n=!0){const i=(0,o.getSegmentation)(e);if(!i)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:r}=i;n?r.add(t):r.delete(t),(0,a.triggerSegmentationModified)(e)}function s(e){const t=(0,o.getSegmentation)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segmentsLocked:n}=t;return Array.from(n)}},57756:(e,t,n)=>{n.r(t),n.d(t,{addColorLUT:()=>y,addSegmentation:()=>S,addSegmentationRepresentation:()=>Z,getColorLUT:()=>A,getDefaultSegmentationStateManager:()=>p,getGlobalConfig:()=>b,getSegmentSpecificRepresentationConfig:()=>_,getSegmentation:()=>v,getSegmentationRepresentationByUID:()=>x,getSegmentationRepresentationSpecificConfig:()=>M,getSegmentationRepresentations:()=>w,getSegmentations:()=>I,getToolGroupIdsWithSegmentation:()=>C,getToolGroupSpecificConfig:()=>E,removeColorLUT:()=>O,removeSegmentation:()=>L,removeSegmentationRepresentation:()=>N,setGlobalConfig:()=>U,setSegmentSpecificRepresentationConfig:()=>R,setSegmentationRepresentationSpecificConfig:()=>T,setToolGroupSpecificConfig:()=>D});var o=n(81653),a=n(71975),i=n.n(a),r=n(84764),s=n(1182);const d={renderOutline:!0,outlineWidthActive:2,outlineWidthInactive:2,outlineOpacity:1,outlineOpacityInactive:.85,renderFill:!0,fillAlpha:1,fillAlphaInactive:0};const l=function(){return d};const c=(0,n(68898).Z)(),g=l(),h={colorLUT:[],segmentations:[],globalConfig:{renderInactiveSegmentations:!0,representations:{[s.Z.Labelmap]:c,[s.Z.Contour]:g}},toolGroups:{}};const u=new class{constructor(e){e||(e=o.Z()),this.state=i()(h),this.uid=e}getState(){return this.state}getToolGroups(){return Object.keys(this.state.toolGroups)}getColorLUT(e){return this.state.colorLUT[e]}resetState(){this.state=i()(h)}getSegmentation(e){return this.state.segmentations.find((t=>t.segmentationId===e))}addSegmentation(e){if(this._initDefaultColorLUTIfNecessary(),this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.state.segmentations.push(e)}getSegmentationRepresentations(e){const t=this.state.toolGroups[e];if(t)return t.segmentationRepresentations}addSegmentationRepresentation(e,t){this.state.toolGroups[e]||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{}}),this.state.toolGroups[e].segmentationRepresentations.push(t),this._handleActiveSegmentation(e,t)}getGlobalConfig(){return this.state.globalConfig}setGlobalConfig(e){this.state.globalConfig=e}getSegmentationRepresentationByUID(e,t){return this.getSegmentationRepresentations(e).find((e=>e.segmentationRepresentationUID===t))}removeSegmentation(e){this.state.segmentations=this.state.segmentations.filter((t=>t.segmentationId!==e))}removeSegmentationRepresentation(e,t){const n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error(`No viewport specific segmentation state found for viewport ${e}`);const o=n.findIndex((e=>e.segmentationRepresentationUID===t));-1===o&&console.warn(`No viewport specific segmentation state data found for viewport ${e} and segmentation data UID ${t}`);const a=n[o];n.splice(o,1),this._handleActiveSegmentation(e,a)}setActiveSegmentationRepresentation(e,t){const n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error(`No segmentation data found for toolGroupId: ${e}`);const o=n.find((e=>e.segmentationRepresentationUID===t));if(!o)throw new Error(`No segmentation data found for segmentation data UID ${t}`);o.active=!0,this._handleActiveSegmentation(e,o)}getToolGroupSpecificConfig(e){const t=this.state.toolGroups[e];if(t)return t.config}getSegmentationRepresentationSpecificConfig(e,t){const n=this.getSegmentationRepresentationByUID(e,t);if(n)return n.segmentationRepresentationSpecificConfig}setSegmentationRepresentationSpecificConfig(e,t,n){const o=this.getSegmentationRepresentationByUID(e,t);o&&(o.segmentationRepresentationSpecificConfig=n)}getSegmentSpecificConfig(e,t,n){const o=this.getSegmentationRepresentationByUID(e,t);if(o)return o.segmentSpecificConfig[n]}setSegmentSpecificConfig(e,t,n){const o=this.getSegmentationRepresentationByUID(e,t);o&&(o.segmentSpecificConfig=n)}setSegmentationRepresentationConfig(e,t){let n=this.state.toolGroups[e];n||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{renderInactiveSegmentations:!0,representations:{}}},n=this.state.toolGroups[e]),n.config={...n.config,...t}}addColorLUT(e,t){this.state.colorLUT[t]&&console.log("Color LUT table already exists, overwriting"),this.state.colorLUT[t]=e}removeColorLUT(e){delete this.state.colorLUT[e]}_handleActiveSegmentation(e,t){const n=this.getSegmentationRepresentations(e);if(0===n.length)return;if(1===n.length)return void(n[0].active=!0);0!==n.filter((e=>e.active)).length?t.active&&n.forEach((e=>{e.segmentationRepresentationUID!==t.segmentationRepresentationUID&&(e.active=!1)})):n[0].active=!0}_initDefaultColorLUTIfNecessary(){0!==this.state.colorLUT.length&&this.state.colorLUT[0]||this.addColorLUT(r.Z,0)}}("DEFAULT");var m=n(35316);const f=function(e){const{segmentationId:t,representation:n}=e;return{segmentationId:t,cachedStats:{},segmentLabels:{},label:null,segmentsLocked:new Set,type:n.type,activeSegmentIndex:1,representationData:{[n.type]:{...n.data}}}};function p(){return u}function v(e){return p().getSegmentation(e)}function I(){return p().getState().segmentations}function S(e,t){const n=p(),o=f(e);n.addSegmentation(o),t||(0,m.triggerSegmentationModified)(o.segmentationId)}function w(e){return p().getSegmentationRepresentations(e)}function C(e){const t=p(),n=t.getState(),o=Object.keys(n.toolGroups),a=[];return o.forEach((n=>{t.getSegmentationRepresentations(n).forEach((t=>{t.segmentationId===e&&a.push(n)}))})),a}function E(e){return p().getToolGroupSpecificConfig(e)}function D(e,t,n){p().setSegmentationRepresentationConfig(e,t),n||(0,m.triggerSegmentationRepresentationModified)(e)}function T(e,t,n,o=!1){p().setSegmentationRepresentationSpecificConfig(e,t,n),o||(0,m.triggerSegmentationRepresentationModified)(e,t)}function M(e,t){return p().getSegmentationRepresentationSpecificConfig(e,t)}function _(e,t,n){return p().getSegmentSpecificConfig(e,t,n)}function R(e,t,n,o=!1){p().setSegmentSpecificConfig(e,t,n),o||(0,m.triggerSegmentationRepresentationModified)(e,t)}function Z(e,t,n){p().addSegmentationRepresentation(e,t),n||(0,m.triggerSegmentationRepresentationModified)(e,t.segmentationRepresentationUID)}function b(){return p().getGlobalConfig()}function U(e,t){p().setGlobalConfig(e),t||(0,m.triggerSegmentationModified)()}function x(e,t){return p().getSegmentationRepresentationByUID(e,t)}function L(e){p().removeSegmentation(e),(0,m.triggerSegmentationRemoved)(e)}function N(e,t){p().removeSegmentationRepresentation(e,t),(0,m.triggerSegmentationRepresentationRemoved)(e,t)}function O(e){p().removeColorLUT(e)}function A(e){return p().getColorLUT(e)}function y(e,t){p().addColorLUT(e,t)}},35316:(e,t,n)=>{n.r(t),n.d(t,{triggerSegmentationDataModified:()=>g,triggerSegmentationModified:()=>c,triggerSegmentationRemoved:()=>s,triggerSegmentationRepresentationModified:()=>l,triggerSegmentationRepresentationRemoved:()=>d});var o=n(97335),a=n(509),i=n(69786),r=n(57756);function s(e){const t={segmentationId:e};(0,o.Z)(a.Z,i.default.SEGMENTATION_REMOVED,t)}function d(e,t){const n={toolGroupId:e,segmentationRepresentationUID:t};(0,o.Z)(a.Z,i.default.SEGMENTATION_REPRESENTATION_REMOVED,n)}function l(e,t){const n={toolGroupId:e,segmentationRepresentationUID:t};if(t)return void(0,o.Z)(a.Z,i.default.SEGMENTATION_REPRESENTATION_MODIFIED,n);((0,r.getSegmentationRepresentations)(e)||[]).forEach((t=>{const{segmentationRepresentationUID:n}=t,r={toolGroupId:e,segmentationRepresentationUID:n};(0,o.Z)(a.Z,i.default.SEGMENTATION_REPRESENTATION_MODIFIED,r)}))}function c(e){let t;t=e?[e]:(0,r.getSegmentations)().map((({segmentationId:e})=>e)),t.forEach((e=>{const t={segmentationId:e};(0,o.Z)(a.Z,i.default.SEGMENTATION_MODIFIED,t)}))}function g(e,t){const n={segmentationId:e,modifiedSlicesToUse:t};(0,o.Z)(a.Z,i.default.SEGMENTATION_DATA_MODIFIED,n)}},26408:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(40622);const a=function(e){return o.ZP.toolGroups.find((t=>t.id===e))}},96018:(e,t,n)=>{n.d(t,{Z:()=>U});var o=n(78266),a=n(27054),i=n(96720),r=n(97335),s=n(509),d=n(75089),l=n(22797),c=n(34894),g=n(41509),h=n(7576),u=n(80686),m=n(15849),f=n(80084),p=n(72076),v=n(82853),I=n(40622),S=n(69786),w=n(11207),C=n(95300),E=n(52857),D=n(22030),T=n(23222),M=n(43356),_=n(1117),R=n(38396);const{transformWorldToIndex:Z}=a;class b extends o.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,r=(0,i.ZP)(o),{viewport:s,renderingEngine:d}=r;this.isDrawing=!0;const l=s.getCamera(),{viewPlaneNormal:c,viewUp:g}=l,u=this.getReferencedImageId(s,a,c,g),m=s.getFrameOfReferenceUID(),f={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...c],viewUp:[...g],FrameOfReferenceUID:m,referencedImageId:u},data:{label:"",handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};(0,h.addAnnotation)(f,o);const p=(0,w.Z)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:p,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,T.hideElementCursor)(o),e.preventDefault(),(0,M.Z)(d,p),f},this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.ZP)(e),{viewport:r}=a,{data:s}=t,{points:d}=s.handles,l=r.worldToCanvas(d[0]),c=r.worldToCanvas(d[3]),g=this._getRectangleImageCoordinates([l,c]),h=[n[0],n[1]],{left:u,top:m,width:f,height:p}=g;return C.Z([u,m,f,p],h)<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,w.Z)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o),(0,T.hideElementCursor)(o);const r=(0,i.ZP)(o),{renderingEngine:s}=r;(0,M.Z)(s,a),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,{data:r}=t;t.highlighted=!0;let s,d=!1;n.worldPosition?d=!0:s=r.handles.points.findIndex((e=>e===n));const l=(0,w.Z)(a,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:s,movingTextBox:d},this._activateModify(a),(0,T.hideElementCursor)(a);const c=(0,i.ZP)(a),{renderingEngine:g}=c;(0,M.Z)(g,l),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:d,hasMoved:l}=this.editData,{data:c}=o;if(d&&!l)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,T.resetElementCursor)(n);const g=(0,i.ZP)(n),{renderingEngine:u}=g;if(this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,h.removeAnnotation)(o.annotationUID),(0,M.Z)(u,a),d){const e=S.default.ANNOTATION_COMPLETED,t={annotation:o};(0,r.Z)(s.Z,e,t)}},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,handleIndex:r,movingTextBox:s}=this.editData,{data:d}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=d.handles,{worldPosition:a}=o;a[0]+=n[0],a[1]+=n[1],a[2]+=n[2],o.hasMoved=!0}else if(void 0===r){const{deltaPoints:e}=t,n=e.world,{points:a}=d.handles;a.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,a=(0,i.ZP)(n),{worldToCanvas:s,canvasToWorld:l}=a.viewport,c=e.world,{points:g}=d.handles;let h,u,m,f,p,v,I,S;switch(g[r]=[...c],r){case 0:case 3:h=s(g[0]),f=s(g[3]),u=[f[0],h[1]],m=[h[0],f[1]],v=l(u),I=l(m),g[1]=v,g[2]=I;break;case 1:case 2:u=s(g[1]),m=s(g[2]),h=[m[0],u[1]],f=[u[0],m[1]],p=l(h),S=l(f),g[0]=p,g[3]=S}o.invalidated=!0}this.editData.hasMoved=!0;const l=(0,i.ZP)(n),{renderingEngine:c}=l;(0,M.Z)(c,a)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,T.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:a}=t;t.highlighted=!1,a.handles.activeHandleIndex=null;const d=(0,i.ZP)(e),{renderingEngine:l}=d;if((0,M.Z)(l,n),o){const e=S.default.ANNOTATION_COMPLETED,n={annotation:t};(0,r.Z)(s.Z,e,n)}return this.editData=null,t.annotationUID}},this._activateDraw=e=>{I.ZP.isInteractingWithTool=!0,e.addEventListener(S.default.MOUSE_UP,this._endCallback),e.addEventListener(S.default.MOUSE_DRAG,this._dragCallback),e.addEventListener(S.default.MOUSE_MOVE,this._dragCallback),e.addEventListener(S.default.MOUSE_CLICK,this._endCallback),e.addEventListener(S.default.TOUCH_END,this._endCallback),e.addEventListener(S.default.TOUCH_DRAG,this._dragCallback),e.addEventListener(S.default.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{I.ZP.isInteractingWithTool=!1,e.removeEventListener(S.default.MOUSE_UP,this._endCallback),e.removeEventListener(S.default.MOUSE_DRAG,this._dragCallback),e.removeEventListener(S.default.MOUSE_MOVE,this._dragCallback),e.removeEventListener(S.default.MOUSE_CLICK,this._endCallback),e.removeEventListener(S.default.TOUCH_END,this._endCallback),e.removeEventListener(S.default.TOUCH_DRAG,this._dragCallback),e.removeEventListener(S.default.TOUCH_TAP,this._endCallback)},this._activateModify=e=>{I.ZP.isInteractingWithTool=!0,e.addEventListener(S.default.MOUSE_UP,this._endCallback),e.addEventListener(S.default.MOUSE_DRAG,this._dragCallback),e.addEventListener(S.default.MOUSE_CLICK,this._endCallback),e.addEventListener(S.default.TOUCH_END,this._endCallback),e.addEventListener(S.default.TOUCH_DRAG,this._dragCallback),e.addEventListener(S.default.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{I.ZP.isInteractingWithTool=!1,e.removeEventListener(S.default.MOUSE_UP,this._endCallback),e.removeEventListener(S.default.MOUSE_DRAG,this._dragCallback),e.removeEventListener(S.default.MOUSE_CLICK,this._endCallback),e.removeEventListener(S.default.TOUCH_END,this._endCallback),e.removeEventListener(S.default.TOUCH_DRAG,this._dragCallback),e.removeEventListener(S.default.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:a}=o;let i=(0,h.getAnnotations)(this.getToolName(),a);if(!i?.length)return n;if(i=this.filterInteractableAnnotationsForElement(a,i),!i?.length)return n;const r=this.getTargetId(o),s=o.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let a=0;a<i.length;a++){const g=i[a],{annotationUID:h,data:I}=g,{points:S,activeHandleIndex:w}=I.handles,C=S.map((e=>o.worldToCanvas(e)));c.annotationUID=h;const D=this.getStyle("lineWidth",c,g),T=this.getStyle("lineDash",c,g),M=this.getStyle("color",c,g),{viewPlaneNormal:_,viewUp:Z}=o.getCamera();if(I.cachedStats[r]&&void 0!==I.cachedStats[r].areaUnit){if(g.invalidated&&(this._throttledCalculateCachedStats(g,_,Z,s,e),o instanceof d.Z)){const{referencedImageId:e}=g.metadata;for(const t in I.cachedStats)if(t.startsWith("imageId")){s.getStackViewports().find((t=>{const n=l.Z(e),o=t.hasImageURI(n),a=l.Z(t.getCurrentImageId());return o&&a!==n}))&&delete I.cachedStats[t]}}}else I.cachedStats[r]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(g,_,Z,s,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let b;if(!(0,m.isAnnotationVisible)(h))continue;if((0,u.isAnnotationLocked)(g)||this.editData||null===w||(b=[C[w]]),b){const e="0";(0,f.Z)(t,h,e,b,{color:M})}const U=`${h}-rect`,x="0";(0,p.Z)(t,h,x,C[0],C[3],{color:M,lineDash:T,lineWidth:D},U),n=!0;const L=(0,R.P)(o,r),N=this.isSuvScaled(o,r,g.metadata.referencedImageId),O=this._getTextLines(I,r,L,N);if(!O||0===O.length)continue;if(!I.handles.textBox.hasMoved){const e=(0,E.Z)(C);I.handles.textBox.worldPosition=o.canvasToWorld(e)}const A=o.worldToCanvas(I.handles.textBox.worldPosition),y="1",P=(0,v.Z)(t,h,y,O,A,C,{},this.getLinkedTextBoxStyle(c,g)),{x:k,y:G,width:W,height:V}=P;I.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([k,G]),topRight:o.canvasToWorld([k+W,G]),bottomLeft:o.canvasToWorld([k,G+V]),bottomRight:o.canvasToWorld([k+W,G+V])}}return n},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._getTextLines=(e,t,n,o)=>{const a=e.cachedStats[t],{area:i,mean:r,max:s,stdDev:d,Modality:l,areaUnit:c}=a;if(void 0===r)return;const g=[],h=(0,_.F)(l,n,o);return g.push(`Area: ${i.toFixed(2)} ${c}²`),g.push(`Mean: ${r.toFixed(2)} ${h}`),g.push(`Max: ${s.toFixed(2)} ${h}`),g.push(`Std Dev: ${d.toFixed(2)} ${h}`),g},this._calculateCachedStats=(e,t,n,o,a)=>{const{data:i}=e,{viewportId:d,renderingEngineId:l}=a,c=i.handles.points[0],g=i.handles.points[3],{cachedStats:h}=i,u=Object.keys(h);for(let e=0;e<u.length;e++){const a=u[e],i=this.getTargetIdImage(a,o);if(!i)continue;const{dimensions:r,imageData:s,metadata:d,hasPixelSpacing:l}=i,m="getScalarData"in i?i.getScalarData():i.scalarData,f=Z(s,c);f[0]=Math.floor(f[0]),f[1]=Math.floor(f[1]),f[2]=Math.floor(f[2]);const p=Z(s,g);if(p[0]=Math.floor(p[0]),p[1]=Math.floor(p[1]),p[2]=Math.floor(p[2]),this._isInsideVolume(f,p,r)){this.isHandleOutsideImage=!1;const e=Math.min(f[0],p[0]),o=Math.max(f[0],p[0]),i=Math.min(f[1],p[1]),s=Math.max(f[1],p[1]),u=Math.min(f[2],p[2]),v=Math.max(f[2],p[2]),{worldWidth:I,worldHeight:S}=(0,D.Z)(t,n,c,g),w=Math.abs(I*S);let C=0,E=0,T=0,M=-1/0;const _=r[0],R=r[0]*r[1];for(let t=u;t<=v;t++)for(let n=i;n<=s;n++)for(let a=e;a<=o;a++){const e=m[t*R+n*_+a];e>M&&(M=e),C++,E+=e}E/=C;for(let t=u;t<=v;t++)for(let n=i;n<=s;n++)for(let a=e;a<=o;a++){const e=m[t*R+n*_+a]-E;T+=e*e}T/=C,T=Math.sqrt(T),h[a]={Modality:d.Modality,area:w,mean:E,stdDev:T,max:M,areaUnit:l?"mm":"px"}}else this.isHandleOutsideImage=!0,h[a]={Modality:d.Modality}}e.invalidated=!1;const m=S.default.ANNOTATION_MODIFIED,f={annotation:e,viewportId:d,renderingEngineId:l};return(0,r.Z)(s.Z,m,f),h},this._isInsideVolume=(e,t,n)=>c.Z(e,n)&&c.Z(t,n),this._throttledCalculateCachedStats=(0,g.Z)(this._calculateCachedStats,100,{trailing:!0})}}b.toolName="RectangleROI";const U=b},68898:(e,t,n)=>{n.d(t,{R:()=>a,Z:()=>i});const o={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85};function a(e){return e&&"boolean"==typeof e.renderOutline&&"number"==typeof e.outlineWidthActive&&"number"==typeof e.outlineWidthInactive&&"boolean"==typeof e.renderFill&&"boolean"==typeof e.renderFillInactive&&"number"==typeof e.fillAlpha&&"number"==typeof e.fillAlphaInactive&&"number"==typeof e.outlineOpacity&&"number"==typeof e.outlineOpacityInactive}const i=function(){return o}},4841:(e,t,n)=>{n.d(t,{Z:()=>E});var o=n(96720),a=n(12145),i=n(60754),r=n(68957),s=n(76370);function d(e,t){const n=Object.assign({},t,{segmentIndex:0});(0,s.p)(e,n)}var l=n(66973);function c(e,t){const n={...t,segmentIndex:0};(0,l.TO)(e,n)}var g=n(44906),h=n(69786),u=n(6355),m=n(23222),f=n(43356),p=n(60443),v=n(33861),I=n(57756),S=n(27977),w=n(87044);class C extends r.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.TO,THRESHOLD_INSIDE_CIRCLE:l.jV,ERASE_INSIDE_CIRCLE:c,FILL_INSIDE_SPHERE:s.p,ERASE_INSIDE_SPHERE:d},strategySpecificConfiguration:{THRESHOLD_INSIDE_CIRCLE:{threshold:[-150,-70]}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25}}){super(e,t),this.onSetToolPassive=()=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=()=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,r=(0,o.ZP)(n),{viewport:s,renderingEngine:d}=r;if(s instanceof a.Z)throw new Error("Not implemented yet");const l=this.toolGroupId,c=p.getActiveSegmentationRepresentation(l);if(!c)throw new Error("No active segmentation detected, create one before using the brush tool");const{segmentationId:g,type:h}=c,u=v.getLockedSegments(g),{representationData:S}=I.getSegmentation(g),{volumeId:w}=S[h],C=i.ZP.getVolume(w),E=s.getActors()[0].uid,D=i.ZP.getVolume(E),T=[s.id];return this._editData={segmentation:C,imageVolume:D,segmentsLocked:u},this._activateDraw(n),(0,m.hideElementCursor)(n),e.preventDefault(),(0,f.Z)(d,T),!0},this.mouseMoveCallback=e=>{this.mode===g.default.Active&&this.updateCursor(e)},this._dragCallback=e=>{const t=e.detail,{element:n}=t,a=(0,o.ZP)(n),{renderingEngine:i}=a,{imageVolume:r,segmentation:s,segmentsLocked:d}=this._editData;this.updateCursor(e);const{segmentIndex:l,segmentationId:c,segmentationRepresentationUID:g,brushCursor:h,viewportIdsToRender:u}=this._hoverData,{data:m}=h,{viewPlaneNormal:p,viewUp:v}=h.metadata;(0,f.Z)(i,u);const I={points:m.handles.points,volume:s,imageVolume:r,segmentIndex:l,segmentsLocked:d,viewPlaneNormal:p,toolGroupId:this.toolGroupId,segmentationId:c,segmentationRepresentationUID:g,viewUp:v,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration};this.applyActiveStrategy(a,I)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{imageVolume:i,segmentation:r,segmentsLocked:s}=this._editData,{segmentIndex:d,segmentationId:l,segmentationRepresentationUID:c,brushCursor:g}=this._hoverData,{data:h}=g,{viewPlaneNormal:u,viewUp:f}=g.metadata;this._deactivateDraw(n),(0,m.resetElementCursor)(n);const p=(0,o.ZP)(n),{viewport:v}=p;if(this._editData=null,this.updateCursor(e),v instanceof a.Z)throw new Error("Not implemented yet");const I={points:h.handles.points,volume:r,imageVolume:i,segmentIndex:d,segmentsLocked:s,viewPlaneNormal:u,toolGroupId:this.toolGroupId,segmentationId:l,segmentationRepresentationUID:c,viewUp:f,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration};this.applyActiveStrategy(p,I)},this._activateDraw=e=>{e.addEventListener(h.default.MOUSE_UP,this._endCallback),e.addEventListener(h.default.MOUSE_DRAG,this._dragCallback),e.addEventListener(h.default.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(h.default.MOUSE_UP,this._endCallback),e.removeEventListener(h.default.MOUSE_DRAG,this._dragCallback),e.removeEventListener(h.default.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:a}=t,i=a.canvas,r=(0,o.ZP)(n),{renderingEngine:s,viewport:d}=r,l=d.getCamera(),{viewPlaneNormal:c,viewUp:g}=l,h=this.toolGroupId,u=p.getActiveSegmentationRepresentation(h);if(!u)return void console.warn("No active segmentation detected, create one before using the brush tool");const{segmentationRepresentationUID:m,segmentationId:v}=u,I=S.getActiveSegmentIndex(v),C=w.getColorForSegmentIndex(h,m,I),E=[d.id],D={metadata:{viewPlaneNormal:[...c],viewUp:[...g],FrameOfReferenceUID:d.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:C},data:{}};this._hoverData={brushCursor:D,centerCanvas:i,segmentIndex:I,segmentationId:v,segmentationRepresentationUID:m,segmentColor:C,viewportIdsToRender:E},this._calculateCursor(n,i),(0,f.Z)(s,E)}_calculateCursor(e,t){const n=(0,o.ZP)(e),{viewport:a}=n,{canvasToWorld:i}=a,{brushSize:r}=this.configuration,s=r,d=[t[0],t[1]+s],l=[t[0],t[1]-s],c=[t[0]-s,t[1]],g=[t[0]+s,t[1]],{brushCursor:h}=this._hoverData,{data:u}=h;void 0===u.handles&&(u.handles={}),u.handles.points=[i(d),i(l),i(c),i(g)],u.invalidated=!1}invalidateBrushCursor(){if(void 0!==this._hoverData){const{data:e}=this._hoverData.brushCursor;e.invalidated=!0}}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const o=this._hoverData.brushCursor;if(!0===o.data.invalidated){const{centerCanvas:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const a=o.metadata,i=a.brushCursorUID,r=o.data,{points:s}=r.handles,d=s.map((e=>n.worldToCanvas(e))),l=d[0],c=d[1],g=[Math.floor((l[0]+c[0])/2),Math.floor((l[1]+c[1])/2)],h=Math.abs(l[1]-Math.floor((l[1]+c[1])/2)),m=`rgb(${a.segmentColor.slice(0,3)})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,u.Z)(t,i,"0",g,h,{color:m})}}C.toolName="Brush";const E=C},49823:(e,t,n)=>{n.d(t,{Z:()=>_});var o=n(27054),a=n(96720),i=n(12145),r=n(60754),s=n(4471),d=n(60157),l=n(97335),c=n(509),g=n(71478),h=n(6807),u=n(69786),m=n(7576),f=n(80686),p=n(80084),v=n(72076),I=n(11207),S=n(41509),w=n(15849),C=n(23222),E=n(43356),D=n(96018);const{transformWorldToIndex:T}=o;class M extends D.Z{constructor(e={},t={configuration:{numSlicesToPropagate:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,l=n.world,c=(0,a.ZP)(o),{viewport:g,renderingEngine:h}=c;this.isDrawing=!0;const u=g.getCamera(),{viewPlaneNormal:f,viewUp:p}=u;let v,S,w;if(g instanceof i.Z)throw new Error("Stack Viewport Not implemented");w=this.getTargetId(g).split("volumeId:")[1],S=r.ZP.getVolume(w),v=s.Z(S,l,f);if(!v)throw new Error("This tool does not work on non-acquisition planes");const D=g.getCurrentImageIdIndex(),T=d.Z(S,f),M=this._getEndSliceIndex(S,l,T,f),_=g.getFrameOfReferenceUID(),R={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...f],enabledElement:c,viewUp:[...p],FrameOfReferenceUID:_,referencedImageId:v,toolName:this.getToolName(),volumeId:w,spacingInNormal:T},data:{label:"",startSlice:D,endSlice:M,cachedStats:{projectionPoints:[],projectionPointsImageIds:[v]},handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...l],[...l],[...l],[...l]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(R,S),(0,m.addAnnotation)(R,o);const Z=(0,I.Z)(o,this.getToolName());return this.editData={annotation:R,viewportIdsToRender:Z,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,C.hideElementCursor)(o),e.preventDefault(),(0,E.Z)(h,Z),R},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,a=(0,m.getAnnotations)(this.getToolName(),o.element);if(!a?.length)return n;const i=o.getCurrentImageIdIndex(),r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let s=0;s<a.length;s++){const d=a[s],{annotationUID:l,data:c}=d,{startSlice:g,endSlice:h}=c,{points:u,activeHandleIndex:m}=c.handles,I=u.map((e=>o.worldToCanvas(e)));r.annotationUID=l;const S=this.getStyle("lineWidth",r,d),C=this.getStyle("lineDash",r,d),E=this.getStyle("color",r,d);if(i<Math.min(g,h)||i>Math.max(g,h))continue;d.invalidated&&this._throttledCalculateCachedStats(d,e);let D,T=!1;if(i!==g&&i!==h||(T=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,w.isAnnotationVisible)(l))continue;if((0,f.isAnnotationLocked)(d)||this.editData||null===m||!T||(D=[I[m]]),D){const e="0";(0,p.Z)(t,l,e,D,{color:E})}let M=C;T||(M=2);const _="0";(0,v.Z)(t,l,_,I[0],I[3],{color:E,lineDash:M,lineWidth:S}),n=!0}return n},this._throttledCalculateCachedStats=(0,S.Z)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:a,spacingInNormal:i}=o,{imageData:r}=t,{startSlice:d,endSlice:l}=n,{points:c}=n.handles,g=T(r,c[0]);if(g[2]!==d)throw new Error("Start slice does not match");const u=h.fromValues(g[0],g[1],l),m=h.create();r.indexToWorldVec3(g,m);const f=h.create();r.indexToWorldVec3(u,f);const p=h.distance(m,f),v=[];for(let e=0;e<p;e+=i)v.push(c.map((t=>{const n=h.create();return h.scaleAndAdd(n,t,a,e),Array.from(n)})));n.cachedStats.projectionPoints=v;const I=[];for(const e of v){const n=s.Z(t,e[0],a);I.push(n)}n.cachedStats.projectionPointsImageIds=I}_calculateCachedStatsTool(e,t){const n=e.data,{viewportId:o,renderingEngineId:a,viewport:i}=t,{cachedStats:s}=n,d=this.getTargetId(i),g=r.ZP.getVolume(d.split("volumeId:")[1]);this._computeProjectionPoints(e,g),e.invalidated=!1;const h=u.default.ANNOTATION_MODIFIED,m={annotation:e,viewportId:o,renderingEngineId:a};return(0,l.Z)(c.Z,h,m),s}_getEndSliceIndex(e,t,n,o){const a=this.configuration.numSlicesToPropagate,i=h.create();h.scaleAndAdd(i,t,o,a*n);const r=n/2,{imageIds:s}=e;let d;for(let e=0;e<s.length;e++){const t=s[e],{imagePositionPatient:n}=g.get("imagePlaneModule",t),a=h.create();h.sub(a,i,n);const l=h.dot(a,o);Math.abs(l)<r&&(d=e)}return d}}M.toolName="RectangleROIStartEndThreshold";const _=M},93160:(e,t,n)=>{n.d(t,{Z:()=>w});var o=n(96720),a=n(12145),i=n(60754),r=n(4471),s=n(97335),d=n(509),l=n(7576),c=n(80686),g=n(69786),h=n(80084),u=n(72076),m=n(11207),f=n(23222),p=n(43356),v=n(15849),I=n(96018);class S extends I.Z{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:s}=t,d=n.world,c=(0,o.ZP)(s),{viewport:g,renderingEngine:h}=c;this.isDrawing=!0;const u=g.getCamera(),{viewPlaneNormal:v,viewUp:I}=u,S=this.getTargetId(g);let w,C;if(g instanceof a.Z)w=S.split("imageId:")[1];else{C=S.split("volumeId:")[1];const e=i.ZP.getVolume(C);w=r.Z(e,d,v)}const E=g.getFrameOfReferenceUID(),D={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...v],enabledElement:c,viewUp:[...I],FrameOfReferenceUID:E,referencedImageId:w,toolName:this.getToolName(),volumeId:C},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...d],[...d],[...d],[...d]],activeHandleIndex:null},segmentationId:null}};(0,l.addAnnotation)(D,s);const T=(0,m.Z)(s,this.getToolName());return this.editData={annotation:D,viewportIdsToRender:T,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(s),(0,f.hideElementCursor)(s),e.preventDefault(),(0,p.Z)(h,T),D},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o,renderingEngineId:a}=e,{element:i}=o;let r=(0,l.getAnnotations)(this.getToolName(),i);if(!r?.length)return n;if(r=this.filterInteractableAnnotationsForElement(i,r),!r?.length)return n;const m={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<r.length;e++){const i=r[e],{annotationUID:l,data:f}=i,{points:p,activeHandleIndex:I}=f.handles,S=p.map((e=>o.worldToCanvas(e)));m.annotationUID=l;const w=this.getStyle("lineWidth",m,i),C=this.getStyle("lineDash",m,i),E=this.getStyle("color",m,i);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const D=g.default.ANNOTATION_MODIFIED,T={annotation:i,viewportId:o.id,renderingEngineId:a};let M;if((0,s.Z)(d.Z,D,T),!(0,v.isAnnotationVisible)(l))continue;if((0,c.isAnnotationLocked)(i)||this.editData||null===I||(M=[S[I]]),M){const e="0";(0,h.Z)(t,l,e,M,{color:E})}const _="0";(0,u.Z)(t,l,_,S[0],S[3],{color:E,lineDash:C,lineWidth:w}),n=!0}return n}}}S.toolName="RectangleROIThreshold";const w=S},66973:(e,t,n)=>{n.d(t,{TO:()=>u,jV:()=>m});var o=n(6807),a=n(27054),i=n(84944),r=n(46879),s=n(86334),d=n(79931),l=n(35316),c=n(91728);const{transformWorldToIndex:g}=a;function h(e,t,n=!1){const{volume:a,imageVolume:i,points:h,segmentsLocked:u,segmentIndex:m,segmentationId:f,strategySpecificConfiguration:p}=t,{imageData:v,dimensions:I}=a,S=a.getScalarData(),{viewport:w}=e,C=o.fromValues(0,0,0);h.forEach((e=>{o.add(C,C,e)})),o.scale(C,C,1/h.length);const E=h.map((e=>w.worldToCanvas(e))),[D,T]=(0,r.Z)(E),M=w.canvasToWorld(D),_=w.canvasToWorld(T),R=[g(v,M),g(v,_)],Z=(0,d.Z)(R,I);if(Z.every((([e,t])=>e!==t)))throw new Error("Oblique segmentation tools are not supported yet");const b={center:C,xRadius:Math.abs(M[0]-_[0])/2,yRadius:Math.abs(M[1]-_[1])/2,zRadius:Math.abs(M[2]-_[2])/2},U=new Set;let x;x=n?({value:e,index:t,pointIJK:n})=>{u.includes(e)||function(e,t,n){const{THRESHOLD_INSIDE_CIRCLE:o}=n,a=t.getScalarData()[e],{threshold:i}=o;return i[0]<=a&&a<=i[1]}(t,i,p)&&(S[t]=m,U.add(n[2]))}:({value:e,index:t,pointIJK:n})=>{u.includes(e)||(S[t]=m,U.add(n[2]))},(0,c.Z)(v,((e,t)=>(0,s.Z)(b,e)),x,Z);const L=Array.from(U);(0,l.triggerSegmentationDataModified)(f,L)}function u(e,t){h(e,t,!1)}function m(e,t){const{volume:n,imageVolume:o}=t;if(!i.Z(n.dimensions,o.dimensions)||!i.Z(n.direction,o.direction))throw new Error("Only source data the same dimensions/size/orientation as the segmentation currently supported.");h(e,t,!0)}},76370:(e,t,n)=>{n.d(t,{p:()=>r});var o=n(35316),a=n(5078);function i(e,t,n=!0){const{viewport:i}=e,{volume:r,segmentsLocked:s,segmentIndex:d,segmentationId:l,points:c}=t,{imageData:g,dimensions:h}=r,u=r.getScalarData(),m=[];(0,a.Z)(g,[c[0],c[1]],(({index:e,value:t})=>{s.includes(t)||(u[e]=d,m.push(e))}),i);const f=h[0]*h[1],p=Math.floor(m[0]/f),v=Math.floor(m[m.length-1]/f),I=Array.from({length:v-p+1},((e,t)=>t+p));(0,o.triggerSegmentationDataModified)(l,I)}function r(e,t){i(e,t,!0)}},77310:(e,t,n)=>{n.d(t,{Z:()=>o});const o=function(e,t){const n=e.findIndex((([e,t])=>e===t));if(-1===n)throw new Error("3D bounding boxes not supported in an oblique plane");return e[n][0]-=t,e[n][1]+=t,e}},79931:(e,t,n)=>{n.d(t,{Z:()=>o});const o=function(e,t){let n=1/0,o=0,a=1/0,i=0,r=1/0,s=0;if(e.forEach((e=>{n=Math.min(e[0],n),o=Math.max(e[0],o),a=Math.min(e[1],a),i=Math.max(e[1],i),r=Math.min(e[2],r),s=Math.max(e[2],s)})),n=Math.floor(n),o=Math.floor(o),a=Math.floor(a),i=Math.floor(i),r=Math.floor(r),s=Math.floor(s),t){const[e,d,l]=t;n=Math.max(0,n),o=Math.min(e-1,o),a=Math.max(0,a),i=Math.min(d-1,i),r=Math.max(0,r),s=Math.min(l-1,s)}return[[n,o],[a,i],[r,s]]}},95300:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(43876);function a(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");const[n,a,i,r]=e;let s=655535;const d=function(e,t,n,o){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+o]],bottom:[[e+n,t+o],[e,t+o]],left:[[e,t+o],[e,t]]}}(n,a,i,r);return Object.keys(d).forEach((e=>{const[n,a]=d[e],i=o.Z(n,a,t);i<s&&(s=i)})),s}},22030:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(6807);function a(e,t,n,a){const i=o.create();o.cross(i,t,e);const r=o.fromValues(...n),s=o.fromValues(...a),d=o.create();o.subtract(d,r,s);const l=o.length(d);if(l<1e-4)return{worldWidth:0,worldHeight:0};const c=o.dot(d,i)/(l*o.length(i));return{worldWidth:Math.sqrt(1-c*c)*l,worldHeight:c*l}}},5078:(e,t,n)=>{n.d(t,{Z:()=>d});var o=n(27054),a=n(6807);var i=n(91728),r=n(79931);const{transformWorldToIndex:s}=o;function d(e,t,n,o){const{boundsIJK:d,centerWorld:l,radiusWorld:c}=function(e,t,n){const[o,i]=e,d=a.fromValues((o[0]+i[0])/2,(o[1]+i[1])/2,(o[2]+i[2])/2),l=a.distance(o,i)/2;let c;if(!n){const e=s(t,d),n=t.getSpacing(),o=Math.min(...n),a=Math.ceil(l/o);return c=[[e[0]-a,e[0]+a],[e[1]-a,e[1]+a],[e[2]-a,e[2]+a]],{boundsIJK:c,centerWorld:d,radiusWorld:l}}return c=function(e,t,n,o,i){const[d,l]=n,c=e.getDimensions(),g=t.getCamera(),h=a.fromValues(g.viewUp[0],g.viewUp[1],g.viewUp[2]),u=a.fromValues(g.viewPlaneNormal[0],g.viewPlaneNormal[1],g.viewPlaneNormal[2]),m=a.create();a.cross(m,h,u);const f=a.create(),p=a.create();a.scaleAndAdd(f,l,u,i),a.scaleAndAdd(p,d,u,-i),a.scaleAndAdd(f,f,m,-i),a.scaleAndAdd(p,p,m,i);const v=[s(e,f),s(e,p)],I=(0,r.Z)(v,c);return I}(t,n,e,0,l),{boundsIJK:c,centerWorld:d,radiusWorld:l}}(t,e,o),g={center:l,radius:c};(0,i.Z)(e,(e=>function(e,t){const{center:n,radius:o}=e;return(t[0]-n[0])**2+(t[1]-n[1])**2+(t[2]-n[2])**2<=o**2}(g,e)),n,d)}},71260:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(68782),a=n(79931),i=n(77310);const r=function(e,t,n={}){const r=[];return e.forEach((e=>{const{data:s}=e,{points:d}=s.handles,{imageData:l,dimensions:c}=t;let g=d;if(s.cachedStats?.projectionPoints){const{projectionPoints:e}=s.cachedStats;g=[].concat(...e)}const h=g.map((e=>o.Z(l,e)));let u=(0,a.Z)(h,c);n.numSlicesToProject&&!s.cachedStats?.projectionPoints&&(u=(0,i.Z)(u,n.numSlicesToProject)),r.push(u)})),1===r.length?r[0]:r.reduce(((e,t)=>({iMin:Math.min(e.iMin,t.iMin),jMin:Math.min(e.jMin,t.jMin),kMin:Math.min(e.kMin,t.kMin),iMax:Math.max(e.iMax,t.iMax),jMax:Math.max(e.jMax,t.jMax),kMax:Math.max(e.kMax,t.kMax)})),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0})}},23918:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(84944),a=n(64819);const i=function(e,t=1,n="mergedLabelmap"){e.forEach((({direction:t,dimensions:n,origin:a,spacing:i})=>{if(!(o.Z(n,e[0].dimensions)&&o.Z(t,e[0].direction)&&o.Z(i,e[0].spacing)&&o.Z(a,e[0].origin)))throw new Error("labelmaps must have the same size and shape")}));const i=e[0],r=new(0,i.getScalarData().constructor)(i.getScalarData().length);e.forEach((e=>{const n=e.getScalarData();for(let e=0;e<n.length;e++)n[e]===t&&(r[e]=t)}));const s={scalarData:r,metadata:i.metadata,spacing:i.spacing,origin:i.origin,direction:i.direction,dimensions:i.dimensions};return a.createLocalVolume(s,n,!0)}},6706:(e,t,n)=>{n.d(t,{Z:()=>d});var o=n(7576),a=n(93160),i=n(49823),r=n(22486),s=n(71260);const d=function(e,t,n,d){const l=e.map((e=>o.getAnnotation(e)));let c;!function(e){const t=[a.Z.toolName,i.Z.toolName];for(const n of e){const e=n.metadata.toolName;if(!t.includes(e))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}(l);for(let e=0;e<n.length;e++){n[e].volume.getScalarData().length!==t.getScalarData().length&&0!==e||(c=(0,s.Z)(l,n[e].volume,d))}return(0,r.Z)(t,n,{...d,boundsIJK:c})}},22486:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(91728),a=n(35316),i=n(45604);const r=function(e,t,n){const{imageData:r}=e,s=e.getScalarData(),{overwrite:d,boundsIJK:l}=n,c=n?.overlapType||0;if(d)for(let e=0;e<s.length;e++)s[e]=0;const{baseVolumeIdx:g,volumeInfoList:h}=(0,i.Ep)(e,t);let u,m,f;const p=(e,t,n)=>{const{imageData:a,dimensions:r,lower:s,upper:d}=e,l=(0,i.yW)(a,r,t,n);m=0,u=0,f={lower:s,upper:d};let g=!1;return(0,o.Z)(a,(()=>!0),(({value:e})=>{m+=1,e>=f.lower&&e<=f.upper&&(u+=1)}),l),0===c?g=u>0:1==c&&(g=u===m),g},v=(e,t)=>{const{imageData:n,referenceValues:o,lower:a,upper:i}=e,r=o[n.computeOffsetIndex(t)];return!(r<=a||r>=i)};return(0,o.Z)(r,(()=>!0),(({index:e,pointIJK:t,pointLPS:n})=>{let o=h.length>0;for(let e=0;e<h.length&&(o=h[e].volumeSize===s.length?v(h[e],t):p(h[e],h[g].spacing,n),o);e++);o&&(s[e]=1)}),l),(0,a.triggerSegmentationDataModified)(e.volumeId),e}},45604:(e,t,n)=>{n.d(t,{Ep:()=>c,ZP:()=>s,yW:()=>l});var o=n(68782),a=n(26408),i=n(4841),r=n(79931);function s(e){const t=(0,a.Z)(e);if(void 0===t)return;const n=t._toolInstances;if(!Object.keys(n).length)return;return Object.values(n).filter((e=>e instanceof i.Z))}const d=(e,t)=>JSON.stringify(e)===JSON.stringify(t);function l(e,t,n,a){const i=[];for(let e=0;e<2;e++)for(let t=0;t<2;t++)for(let o=0;o<2;o++){const r=a;r[0]=r[0]+(2*e-1)*n[0]/2,r[1]=r[1]+(2*t-1)*n[1]/2,r[2]=r[2]+(2*o-1)*n[2]/2,i.push(r)}const s=i.map((t=>o.Z(e,t)));return(0,r.Z)(s,t)}function c(e,t){const{spacing:n,imageData:o}=e,a=e.getScalarData(),i=[];let r=0;for(let e=0;e<t.length;e++){const{imageData:o,spacing:s,dimensions:l}=t[e].volume,c=t[e].volume.getScalarData().length;c===a.length&&d(s,n)&&(r=e);const g=o.getPointData().getScalars().getData(),h=t[e].lower,u=t[e].upper;i.push({imageData:o,referenceValues:g,lower:h,upper:u,spacing:s,dimensions:l,volumeSize:c})}return{volumeInfoList:i,baseVolumeIdx:r}}}}]);
//# sourceMappingURL=619.bundle.b7cddacd646a8f1de1e6.js.map